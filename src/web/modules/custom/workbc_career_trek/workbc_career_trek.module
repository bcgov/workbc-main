<?php

/**
 * Implements hook_form_FORM_ID_alter() to update the textfield to the multiple checkbox field in the view exposed filter.
 */
function workbc_career_trek_form_views_exposed_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
    // Check if this is the specific view and display you want to alter.
    if ($form['#id'] == 'views-exposed-form-career-trek-video-library-block-1') {
      // Check if the specific filter exists in the form.
      if (isset($form['minimum_education_1'])) {
        $clone = $form['regions'];
        unset($form['minimum_education_1']);
        $clone['#name'] = 'minimum_education_1';
        $clone['#options'] = [
          0 => 'Management',
          1 => 'University Degree',
          2 => 'College Diploma or Apprenticeship, 2 or more years',
          3 => 'College Diploma or Apprenticeship, less than 2 years',
          4 => 'High School Diploma',
          5 => 'No Formal Education'
        ];
        $form['minimum_education_all'] = $clone;
      }
    }
}

/**
 * Implements hook_uninstall().
 */
function workbc_career_trek_uninstall() {
    // Load the entity type manager service.
    $entity_type_manager = \Drupal::entityTypeManager();
  
    // Load and remove paragraph items of type 'section_icons_1_3' before removing its fields and type.
    $paragraph_items = $entity_type_manager->getStorage('paragraph')->loadByProperties(['type' => 'section_icons_1_3']);
    foreach ($paragraph_items as $paragraph_item) {
      $paragraph_item->delete();
    }
    if ($paragraph_type = $entity_type_manager->getStorage('paragraphs_type')->load('section_icons_1_3')) {
      $field_definitions = $entity_type_manager->getStorage('field_config')->loadByProperties(['entity_type' => 'paragraph', 'bundle' => 'section_icons_1_3']);
      foreach ($field_definitions as $field_definition) {
        $field_definition->delete();
      }
      $paragraph_type->delete();
    }
  
    // Load and remove paragraph items of type 'banner_video' before deleting its fields and type.
    $paragraph_items = $entity_type_manager->getStorage('paragraph')->loadByProperties(['type' => 'banner_video']);
    foreach ($paragraph_items as $paragraph_item) {
      $paragraph_item->delete();
    }
    // Load the paragraph type 'section_icons_1_3' and remove its fields.
    if ($paragraph_type = $entity_type_manager->getStorage('paragraphs_type')->load('section_icons_1_3')) {
      $field_definitions = $entity_type_manager->getStorage('field_config')->loadByProperties(['entity_type' => 'paragraph', 'bundle' => 'section_icons_1_3']);
      foreach ($field_definitions as $field_definition) {
        $field_definition->delete();
      }
      $paragraph_type->delete();
    }
  
    // Load the paragraph type 'banner_video' and delete its fields.
    if ($paragraph_type = $entity_type_manager->getStorage('paragraphs_type')->load('banner_video')) {
      $field_storage_definitions = $entity_type_manager->getStorage('field_storage_config')->loadByProperties(['entity_type' => 'paragraph', 'bundle' => 'banner_video']);
      foreach ($field_storage_definitions as $field_storage_definition) {
        $field_storage_definition->delete();
      }
      $paragraph_type->delete();
    }

    // Remove views from the website.
    $views_to_remove = [
      'banner_video',
      'career_trek_video_library',
      'related_careers_videos',
    ];
    foreach ($views_to_remove as $view_id) {
      if ($view = $entity_type_manager->getStorage('view')->load($view_id)) {
        $view->delete();
      }
    }

    // Remove the simple block 'find_resources_for_educators'.
    if ($block = $entity_type_manager->getStorage('simple_block')->load('find_resources_for_educators')) {
      $block->delete();
    }

    // Remove the search API server 'solr_search'.
    if ($server = $entity_type_manager->getStorage('search_api_server')->load('solr_search')) {
      $server->delete();
    }

    // Remove the search API index 'career_profile_index'.
    if ($index = $entity_type_manager->getStorage('search_api_index')->load('career_profile_index')) {
      $index->delete();
    }
}